# AuroraQ ë°±í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ v2

ì ì‘í˜•Â·í™•ë¥ ì Â·ë‹¤ì¤‘í”„ë ˆì„ ë°±í…ŒìŠ¤íŠ¸ í™˜ê²½

## ğŸ“‹ ê°œìš”

AuroraQ ë°±í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ v2ëŠ” 5ë¶„ë´‰ ì¤‘ì €ë¹ˆë„ ì „ëµì˜ ìƒ˜í”Œ ë¶€ì¡±ê³¼ ë…¸ì´ì¦ˆ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ ê³ ë„í™”ëœ ë°±í…ŒìŠ¤íŠ¸ í™˜ê²½ì…ë‹ˆë‹¤.

### ğŸ¯ í•µì‹¬ ëª©í‘œ

- **ì‹¤ì „ ê´´ë¦¬ ìµœì†Œí™”**: ìŠ¬ë¦¬í”¼ì§€, ìˆ˜ìˆ˜ë£Œ, ì‹œì¥ ì˜í–¥ì„ í˜„ì‹¤ì ìœ¼ë¡œ ëª¨ë¸ë§
- **ì ì‘í˜• ì‹ í˜¸ ì²˜ë¦¬**: ì‹œì¥ ë ˆì§ê³¼ ê°ì •ì— ë”°ë¥¸ ë™ì  ì„ê³„ê°’ ì¡°ì •
- **í™•ë¥ ì  í¬ì§€ì…˜ ê´€ë¦¬**: ì‹ ë¢°ë„ ê¸°ë°˜ í¬ì§€ì…˜ í¬ê¸° ë° Kelly ê¸°ì¤€ ì ìš©
- **ë‹¤ì¤‘ íƒ€ì„í”„ë ˆì„**: 5ë¶„ë´‰, 15ë¶„ë´‰, 1ì‹œê°„ë´‰ í†µí•© ë¶„ì„
- **í•™ìŠµ í”¼ë“œë°±**: PPOì™€ MABì— ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìë™ ë°˜ì˜

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### 5ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Controller Layer                       â”‚
â”‚           (BacktestOrchestrator)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Evaluation Layer                         â”‚
â”‚     (StandardizedMetrics + Sample Weighting)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Execution Layer                            â”‚
â”‚   (Kelly Criterion + Slippage + Market Impact)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Signal Layer                              â”‚
â”‚  (Adaptive Entry + Probabilistic + Time Filters)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Data Layer                               â”‚
â”‚     (Multi-Timeframe + Sentiment + Indicators)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### 1. ë°ì´í„° ê³„ì¸µ (Data Layer)
- **MultiTimeframeData**: 5ë¶„ë´‰ â†’ 15ë¶„ë´‰, 1ì‹œê°„ë´‰ ìë™ ë³€í™˜
- **IndicatorCache**: ì¤‘ë³µ ê³„ì‚° ë°©ì§€ (30-50% ì„±ëŠ¥ í–¥ìƒ)
- **SentimentAlignment**: ê°€ê²© ë°ì´í„°ì™€ ê°ì • ì ìˆ˜ ì‹œê°„ ì •ë ¬

### 2. ì‹œê·¸ë„ ì²˜ë¦¬ ê³„ì¸µ (Signal Processing Layer)
- **AdaptiveEntrySystem**: ë³€ë™ì„±/ë ˆì§/ê°ì • ê¸°ë°˜ ë™ì  ì„ê³„ê°’
- **ProbabilisticEntry**: ì‹ ë¢°ë„ ê¸°ë°˜ í¬ì§€ì…˜ í¬ê¸° ê²°ì •
- **TimeBasedFilter**: ì„¸ì…˜ë³„(ì•„ì‹œì•„/ìœ ëŸ½/ë¯¸êµ­) ë…¸ì´ì¦ˆ í•„í„°ë§
- **MultiTimeframeConfirmation**: ìƒìœ„ íƒ€ì„í”„ë ˆì„ ì‹ í˜¸ ê°€ì¤‘ì¹˜

### 3. ì‹¤í–‰ ì‹œë®¬ë ˆì´ì…˜ ê³„ì¸µ (Execution Simulation Layer)
- **RiskAdjustedEntry**: Kelly ê¸°ì¤€ ê¸°ë°˜ ë¦¬ìŠ¤í¬ ì¡°ì •
- **SlippageModel**: ë³€ë™ì„±ê³¼ ê±°ë˜ëŸ‰ ê¸°ë°˜ ë™ì  ìŠ¬ë¦¬í”¼ì§€
- **FeeModel**: Binance ìˆ˜ìˆ˜ë£Œ êµ¬ì¡° ëª¨ë¸ë§
- **MarketImpactSimulator**: ê±°ë˜ëŸ‰ ëŒ€ë¹„ ì‹œì¥ ì˜í–¥ ê³„ì‚°

### 4. í‰ê°€ ê³„ì¸µ (Evaluation Layer)
- **StandardizedMetrics**: ROI, Sharpe, Sortino, Profit Factor ë“±
- **SampleWeightCalculator**: í‘œë³¸ ìˆ˜ ê¸°ë°˜ ì „ëµ ì ìˆ˜ ê°€ì¤‘ì¹˜
- **ReportGenerator**: CSV/JSON í˜•íƒœ ìƒì„¸ ë³´ê³ ì„œ

### 5. ì»¨íŠ¸ë¡¤ëŸ¬ ê³„ì¸µ (Controller Layer)
- **BacktestController**: ë‹¨ì¼ ë°±í…ŒìŠ¤íŠ¸ ê´€ë¦¬
- **BacktestOrchestrator**: ë³µìˆ˜ ë°±í…ŒìŠ¤íŠ¸ ë³‘ë ¬ ì‹¤í–‰
- **WalkForwardAnalysis**: ì‹œê°„ ë¶„í•  ê²€ì¦

## ğŸ”„ PPO/MAB í”¼ë“œë°± ë£¨í”„

### BacktestFeedbackBridge
- **PPOExperienceBuffer**: ë°±í…ŒìŠ¤íŠ¸ ê²½í—˜ì„ PPO í•™ìŠµ ë°ì´í„°ë¡œ ë³€í™˜
- **MABFeedbackProcessor**: ì „ëµë³„ ì„±ê³¼ë¥¼ MAB ë³´ìƒìœ¼ë¡œ ë°˜ì˜
- **StateEncoder**: ì‹œì¥ ìƒíƒœë¥¼ ì‹ ê²½ë§ ì…ë ¥ìœ¼ë¡œ ì¸ì½”ë”©

### í”¼ë“œë°± í”Œë¡œìš°
```
Backtest Results â†’ Feedback Bridge â†’ [PPO Buffer | MAB Rewards] â†’ Strategy Learning
```

## ğŸš€ ì‚¬ìš©ë²•

### ê¸°ë³¸ ë°±í…ŒìŠ¤íŠ¸

```python
from backtest.v2.layers.controller_layer import BacktestController, BacktestMode

# ì»¨íŠ¸ë¡¤ëŸ¬ ìƒì„±
controller = BacktestController(
    initial_capital=1000000,
    mode=BacktestMode.NORMAL,
    enable_multiframe=True,
    enable_exploration=False
)

# ì „ëµ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
controller.initialize_strategies(
    sentiment_file=\"data/sentiment.csv\",
    enable_ppo=True
)

# ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
result = controller.run_backtest(
    price_data_path=\"data/price_data.csv\",
    sentiment_data_path=\"data/sentiment.csv\",
    window_size=100,
    indicators=[\"sma_20\", \"rsi\", \"macd\", \"atr\"]
)
```

### ë³µìˆ˜ ë°±í…ŒìŠ¤íŠ¸

```python
from backtest.v2.layers.controller_layer import BacktestOrchestrator

# ì„¤ì • ëª©ë¡
configurations = [
    {
        \"name\": \"normal_mode\",
        \"price_data_path\": \"data/price_data.csv\",
        \"mode\": BacktestMode.NORMAL,
        \"enable_exploration\": False
    },
    {
        \"name\": \"exploration_mode\",
        \"price_data_path\": \"data/price_data.csv\",
        \"mode\": BacktestMode.EXPLORATION,
        \"enable_exploration\": True
    }
]

# ë³‘ë ¬ ì‹¤í–‰
orchestrator = BacktestOrchestrator(n_workers=4)
results = orchestrator.run_multiple_backtests(configurations, parallel=True)
```

### ì›Œí¬í¬ì›Œë“œ ë¶„ì„

```python
# ì‹œê°„ ë¶„í•  ê²€ì¦
wf_result = orchestrator.walk_forward_analysis(
    base_config={
        \"price_data_path\": \"data/price_data.csv\",
        \"start_date\": \"2023-01-01\",
        \"end_date\": \"2023-12-31\"
    },
    n_windows=10,
    train_ratio=0.7
)
```

## ğŸ“Š ì„±ëŠ¥ íŠ¹ì§•

### ì†ë„ ìµœì í™”
- **ì§€í‘œ ìºì‹±**: ì¤‘ë³µ ê³„ì‚° ì œê±°ë¡œ 30-50% ì„±ëŠ¥ í–¥ìƒ
- **ë³‘ë ¬ ì²˜ë¦¬**: ë‹¤ì¤‘ ë°±í…ŒìŠ¤íŠ¸ ë™ì‹œ ì‹¤í–‰
- **ë©”ëª¨ë¦¬ íš¨ìœ¨**: ë°ì´í„° ìœˆë„ìš° ê¸°ë°˜ ì ì§„ì  ì²˜ë¦¬

### ì •í™•ë„ ê°œì„ 
- **ë™ì  ìŠ¬ë¦¬í”¼ì§€**: ë³€ë™ì„±ê³¼ ê±°ë˜ëŸ‰ ë°˜ì˜
- **ì‹œì¥ ì˜í–¥**: ì£¼ë¬¸ í¬ê¸° ëŒ€ë¹„ ê°€ê²© ì˜í–¥ ëª¨ë¸ë§
- **ì„¸ì…˜ë³„ í•„í„°**: ì‹œê°„ëŒ€ë³„ ë…¸ì´ì¦ˆ ìˆ˜ì¤€ ì°¨ë“± ì ìš©

## ğŸ“ˆ ë©”íŠ¸ë¦­ ì‹œìŠ¤í…œ

### í‘œì¤€í™”ëœ ë©”íŠ¸ë¦­
- **ìˆ˜ìµì„±**: ROI, ì—°ìœ¨í™” ìˆ˜ìµë¥ 
- **ë¦¬ìŠ¤í¬ ì¡°ì •**: Sharpe, Sortino, Calmar Ratio
- **ë¦¬ìŠ¤í¬**: Max Drawdown, VaR, CVaR
- **ê±°ë˜ í†µê³„**: ìŠ¹ë¥ , Profit Factor, Expectancy
- **íš¨ìœ¨ì„±**: í‰ê·  ë³´ìœ ì‹œê°„, ê±°ë˜ ë¹ˆë„

### í‘œë³¸ ê¸°ë°˜ ê°€ì¤‘ì¹˜
- **ìµœì†Œ í‘œë³¸**: 30ê°œ ê±°ë˜ ë¯¸ë§Œ ì‹œ í˜ë„í‹°
- **ìµœì  í‘œë³¸**: 100ê°œ ê±°ë˜ì—ì„œ ë§Œì 
- **ì‹ ë¢°ë„ ê³„ì‚°**: Wilson Score Interval ê¸°ë°˜

## ğŸ› ï¸ ì˜ì¡´ì„±

### í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬
```bash
pip install pandas numpy talib tqdm
```

### ê¸°ì¡´ AuroraQ ì‹œìŠ¤í…œ
- core.strategy_selector
- strategy.mab_selector
- core.ppo_agent_proxy

## ğŸ“‹ ì˜ˆì œ

`example_usage.py` íŒŒì¼ì—ì„œ ë‹¤ì–‘í•œ ì‚¬ìš© ì˜ˆì œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **ê°„ë‹¨í•œ ë°±í…ŒìŠ¤íŠ¸**: ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
2. **íƒìƒ‰ ëª¨ë“œ**: ëœë¤ ì „ëµ ì„ íƒìœ¼ë¡œ ë°ì´í„° ìˆ˜ì§‘
3. **ë³µìˆ˜ ë°±í…ŒìŠ¤íŠ¸**: ì—¬ëŸ¬ ì„¤ì • ë³‘ë ¬ ë¹„êµ
4. **ì›Œí¬í¬ì›Œë“œ ë¶„ì„**: ì‹œê°„ ë¶„í•  ê²€ì¦

## ğŸ”§ í™•ì¥ì„±

### ìƒˆë¡œìš´ ì§€í‘œ ì¶”ê°€
`DataLayer.calculate_indicators()` ë©”ì„œë“œ í™•ì¥

### ìƒˆë¡œìš´ ìŠ¬ë¦¬í”¼ì§€ ëª¨ë¸
`SlippageModel` í´ë˜ìŠ¤ ìƒì† ë° êµ¬í˜„

### ìƒˆë¡œìš´ í‰ê°€ ë©”íŠ¸ë¦­
`MetricsCalculator._calculate_composite_score()` ìˆ˜ì •

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ë°ì´í„° í’ˆì§ˆ**: OHLCV ë°ì´í„°ì˜ ë¬´ê²°ì„± í™•ì¸ í•„ìš”
2. **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: í° ë°ì´í„°ì…‹ì˜ ê²½ìš° ìœˆë„ìš° í¬ê¸° ì¡°ì •
3. **í”¼ë“œë°± ì‹œìŠ¤í…œ**: PPO/MAB í†µí•© ì‹œ ì¶©ë¶„í•œ í•™ìŠµ ë°ì´í„° í™•ë³´

## ğŸ¯ ì‹¤ì œ ì „ëµ ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ê¸°

### ì¤€ë¹„ ë‹¨ê³„

1. **ë°ì´í„° íŒŒì¼ ì¤€ë¹„** (CSV í˜•ì‹):
   ```
   data/btc_5m_sample.csv  (ê°€ê²© ë°ì´í„°)
   data/sentiment_sample.csv  (ê°ì • ë°ì´í„°, ì„ íƒì‚¬í•­)
   ```

2. **ê°€ê²© ë°ì´í„° í˜•ì‹**:
   ```csv
   timestamp,open,high,low,close,volume
   2024-01-01 00:00:00,50000,50100,49900,50050,1000
   ```

### ì‹¤í–‰ ëª…ë ¹ì–´

#### Windows:
```cmd
# ë°°ì¹˜ íŒŒì¼ë¡œ ì‹¤í–‰ (ê°€ì¥ ê°„ë‹¨)
run_backtest.bat

# ë˜ëŠ” Python ì§ì ‘ ì‹¤í–‰
python run_backtest.py --price-data data/btc_5m_sample.csv --initial-capital 1000000
```

#### Linux/Mac:
```bash
# ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‹¤í–‰
./run_backtest.sh

# ë˜ëŠ” Python ì§ì ‘ ì‹¤í–‰
python3 run_backtest.py --price-data data/btc_5m_sample.csv --initial-capital 1000000
```

### ê³ ê¸‰ ì˜µì…˜

```bash
# ë‚ ì§œ ë²”ìœ„ ì§€ì •í•˜ì—¬ ë°±í…ŒìŠ¤íŠ¸
python run_backtest.py \
    --price-data data/btc_5m.csv \
    --start-date 2024-01-01 \
    --end-date 2024-03-31 \
    --initial-capital 1000000 \
    --window-size 100 \
    --mode normal

# íƒìƒ‰ ëª¨ë“œë¡œ ë‹¤ì–‘í•œ ì „ëµ ì‹œë„
python run_backtest.py \
    --price-data data/btc_5m.csv \
    --enable-exploration \
    --mode exploration

# ê°ì • ë°ì´í„° í¬í•¨
python run_backtest.py \
    --price-data data/btc_5m.csv \
    --sentiment-data data/sentiment.csv
```

### ë“±ë¡ëœ ì „ëµë“¤

ë‹¤ìŒ ì „ëµë“¤ì´ ìë™ìœ¼ë¡œ ë“±ë¡ë˜ì–´ ë°±í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©ë©ë‹ˆë‹¤:

1. **RuleStrategyA**: EMA í¬ë¡œìŠ¤ì˜¤ë²„ + ADX íŠ¸ë Œë“œ ê°•ë„
2. **RuleStrategyB**: RSI ì—­ì „ + ë³¼ë¥¨ í™•ì¸  
3. **RuleStrategyC**: ë³¼ë¦°ì € ë°´ë“œ + ëª¨ë©˜í…€
4. **RuleStrategyD**: MACD + ê°€ê²© ì•¡ì…˜
5. **RuleStrategyE**: ë³µí•© ì§€í‘œ + ì‹œê°„ í•„í„°

### ê²°ê³¼ í™•ì¸

ë°±í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ `reports/backtest/` ë””ë ‰í† ë¦¬ì—ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- `*_trades.csv`: ê°œë³„ ê±°ë˜ ê¸°ë¡
- `*_metrics.csv`: ì„±ê³¼ ì§€í‘œ
- `*_report.json`: ì¢…í•© ë³´ê³ ì„œ
- `strategy_comparison_*.csv`: ì „ëµë³„ ë¹„êµ

### íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

1. **ëª¨ë“ˆ ì„í¬íŠ¸ ì˜¤ë¥˜**: í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”
2. **ë°ì´í„° íŒŒì¼ ì—†ìŒ**: data/ ë””ë ‰í† ë¦¬ì— CSV íŒŒì¼ì„ ì¤€ë¹„í•˜ì„¸ìš”
3. **ì „ëµ ë“±ë¡ ì‹¤íŒ¨**: strategy/ ë””ë ‰í† ë¦¬ì˜ ì „ëµ íŒŒì¼ë“¤ì„ í™•ì¸í•˜ì„¸ìš”

## ğŸ“ ì§€ì›

ë¬¸ì œ ë°œìƒ ì‹œ ë¡œê·¸ ë ˆë²¨ì„ DEBUGë¡œ ì„¤ì •í•˜ì—¬ ìƒì„¸ ì •ë³´ í™•ì¸:

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```